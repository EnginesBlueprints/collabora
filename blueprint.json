{"software":{"name":"collabora","major":null,"minor":1,"release_level":"Alpha","patch":null,"license_name":"gnu_general_public_license_v3","license_label":"GNU GENERAL PUBLIC LICENSE V3","license_sourceurl":"http://www.gnu.org/copyleft/gpl.html","full_title":"Collabora","short_title":"Collabora","description":"","icon_url":"","home_page_url":"","support_page_url":"","about":"","language":"external","framework":"docker","deployment_type":"web","web_root_directory":"","first_run_url":"","publisher":"engines","blocking_worker_name":null,"required_memory":512,"recommended_memory":1024,"http_protocol":"http_and_https","framework_port_overide":5222,"custom_start_script":"#!/bin/bash\r\ncd /\r\nPID_FILE=/tmp/col.pid\r\nexport PID_FILE\r\n. /home/trap.sh\r\ncp /home/nginx.site /etc/nginx/sites-enabled\r\nmkdir /var/log/nginx\r\n\r\nln -s /etc/resolv.conf /opt/lool/systemplate/etc/resolv.conf\r\n\r\n# Generate new SSL certificate instead of using the default\r\nmkdir -p /opt/ssl/\r\ncd /opt/ssl/\r\nmkdir -p certs/ca\r\nopenssl genrsa -out certs/ca/root.key.pem 2048\r\nopenssl req -x509 -new -nodes -key certs/ca/root.key.pem -days 9131 -out certs/ca/root.crt.pem -subj \"/C=DE/ST=BW/L=Stuttgart/O=Dummy Authority/CN=Dummy Authority\"\r\nmkdir -p certs/{servers,tmp}\r\nmkdir -p \"certs/servers/localhost\"\r\nopenssl genrsa -out \"certs/servers/localhost/privkey.pem\" 2048 -key \"certs/servers/localhost/privkey.pem\"\r\nopenssl req -key \"certs/servers/localhost/privkey.pem\" -new -sha256 -out \"certs/tmp/localhost.csr.pem\" -subj \"/C=DE/ST=BW/L=Stuttgart/O=Dummy Authority/CN=localhost\"\r\n\r\nopenssl x509 -req -in certs/tmp/localhost.csr.pem -CA certs/ca/root.crt.pem -CAkey certs/ca/root.key.pem -CAcreateserial -out certs/servers/localhost/cert.pem -days 9131\r\n\r\nmv certs/servers/localhost/privkey.pem /etc/loolwsd/key.pem\r\nmv certs/servers/localhost/cert.pem /etc/loolwsd/cert.pem\r\nmv certs/ca/root.crt.pem /etc/loolwsd/ca-chain.cert.pem\r\n\r\nperl -pi -e \"s/localhost\u003c\\/host\u003e/${domain}\u003c\\/host\u003e/g\" /etc/loolwsd/loolwsd.xml\r\nperl -pi -e \"s/\u003cusername desc=\\\"The username of the admin console. Must be set.\\\"\u003e\u003c\\/username\u003e/\u003cusername desc=\\\"The username of the admin console. Must be set.\\\"\u003e${username}\u003c\\/username\u003e/\" /etc/loolwsd/loolwsd.xml\r\nperl -pi -e \"s/\u003cpassword desc=\\\"The password of the admin console. Must be set.\\\"\u003e\u003c\\/password\u003e/\u003cpassword desc=\\\"The password of the admin console. Must be set.\\\"\u003e${password}\u003c\\/password\u003e/g\" /etc/loolwsd/loolwsd.xml\r\n\r\nname=`hostname`\r\nif test -f /engines/var/run/_Engines_Builder(fqdn).crt\r\n then\r\ncp /engines/var/run/_Engines_Builder(fqdn).crt /etc/loolwsd/cert.pem\r\ncp /engines/var/run/_Engines_Builder(fqdn).key /etc/loolwsd/key.pem\r\n cp /usr/local/share/ca-certificates/engines_internal_ca.crt  /etc/loolwsd/ca-chain.cert.pem\r\nfi\r\n\r\nmkdir -p  /engines/var/run/flags/\r\nsu -c \"/usr/bin/loolwsd --version --o:sys_template_path=/opt/lool/systemplate --o:lo_template_path=/opt/collaboraoffice5.1 --o:child_root_path=/opt/lool/child-roots --o:file_server_root_path=/usr/share/loolwsd\" -s /bin/bash lool \u0026\r\n\r\necho -n $! \u003e /tmp/col.pid\r\n\r\ntouch /engines/var/run/flags/startup_complete\r\nnginx \u0026\r\nngpid=`cat /var/run/nginx.pid`\r\necho -n \" $ngpid\" \u003e\u003e /tmp/col.pid\r\nwait\r\nrm /engines/var/run/flags/startup_complete\r\n","custom_install_script":"#!/bin/bash\r\nchown -R lool /etc/loolwsd\r\nchown  lool /etc/nginx/sites-enabled","custom_post_install_script":"","service_configurations":[{"publisher_namespace":"EnginesSystem","type_path":"cert_auth","variables":{"domainname":"_Engines_Builder(fqdn)","cert_name":"_Engines_Builder(fqdn)","person":"collabora","city":"Local","organisation":"Engines Internal","state":"NSW","country":""}}],"persistent_directories":[{"path":"data"}],"replacement_strings":[],"persistent_files":[],"installed_packages":[{"name":"Collabora","source_url":"collabora/code","destination":"lool","extraction_command":"docker","path_to_extracted":"MKNOD"}],"system_packages":[{"package":"nginx"},{"package":"apache2"}],"workers":[],"ports":[{"port":5222,"external":5222,"protocol":"TCP"}],"external_repositories":[],"rake_tasks":[],"template_files":[{"title":"nginx_site","path":"/home/nginx.site","content":"  \r\n\r\nproxy_http_version 1.1;\r\nproxy_buffering off;\r\n\r\n\r\n\r\nserver {\r\n    listen       5222 ssl;\r\n    server_name  _Engines_Builder(fqdn);\r\n\r\n    ssl_certificate /etc/loolwsd/cert.pem;\r\n    ssl_certificate_key  /etc/loolwsd/key.pem;\r\n\r\n # static files\r\n    location ^~ /loleaflet {\r\n        proxy_pass https://127.0.0.1:9980;\r\n        proxy_set_header Host $http_host;\r\n    }\r\n\r\n    # WOPI discovery URL\r\n    location ^~ /hosting/discovery {\r\n        proxy_pass https://127.0.0.1:9980;\r\n        proxy_set_header Host $http_host;\r\n    }\r\n\r\n    # Main websocket\r\n    location ~ /lool/(.*)/ws$ {\r\n        proxy_pass https://127.0.0.1:9980;\r\n        proxy_set_header Upgrade $http_upgrade;\r\n        proxy_set_header Connection \"Upgrade\";\r\n        proxy_set_header Host $http_host;\r\n        proxy_read_timeout 36000s;\r\n    }\r\n\r\n    # Admin Console websocket\r\n    location ^~ /lool/adminws {\r\n        proxy_pass https://127.0.0.1:9980;\r\n        proxy_set_header Upgrade $http_upgrade;\r\n        proxy_set_header Connection \"Upgrade\";\r\n        proxy_set_header Host $http_host;\r\n        proxy_read_timeout 36000s;\r\n    }\r\n\r\n    # download, presentation and image upload\r\n    location ^~ /lool {\r\n        proxy_pass https://127.0.0.1:9980;\r\n        proxy_set_header Host $http_host;\r\n    }\r\n}"}],"file_write_permissions":[],"custom_php_inis":[],"apache_htaccess_files":[],"apache_httpd_configurations":[],"modules":[],"variables":[{"name":"domain","value":"_Engines_Builder(fqdn)","label":"","field_type":"","select_collection":"","tooltip":"","hint":"","placeholder":"","comment":"","regex_validator":"","regex_invalid_message":"","mandatory":false,"ask_at_build_time":false,"build_time_only":false,"immutable":false}],"component_sources":[],"component_path":"","extract_components":false,"installation_report_template":"","continuous_deployment":false,"database_seed_file":"","actionators":{}}}
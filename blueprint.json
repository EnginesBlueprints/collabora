{"software":{"name":"collabora","major":null,"minor":1,"release_level":"Alpha","patch":null,"license_name":"gnu_general_public_license_v3","license_label":"GNU GENERAL PUBLIC LICENSE V3","license_sourceurl":"http://www.gnu.org/copyleft/gpl.html","full_title":"Collabora","short_title":"Collabora","description":"","icon_url":"","home_page_url":"","support_page_url":"","about":"","language":"external","framework":"docker","deployment_type":"web","web_root_directory":"","first_run_url":"","publisher":"engines","blocking_worker_name":null,"required_memory":384,"recommended_memory":512,"http_protocol":"https_only","framework_port_overide":5222,"custom_start_script":"#!/bin/bash\r\ncd /\r\nPID_FILE=/tmp/col.pid\r\nexport PID_FILE\r\n. /home/trap.sh\r\nif ! test =d /var/log/apache2/\r\n then\r\n  mkdir /var/log/apache2/\r\nfi\r\n\r\ncp /home/loolwsd.xml /etc/loolwsd/loolwsd.xml\r\n\r\n\r\nperl -pi -e \"s/localhost\u003c\\/host\u003e/${domain}\u003c\\/host\u003e/g\" /etc/loolwsd/loolwsd.xml\r\nperl -pi -e \"s/\u003cusername desc=\\\"The username of the admin console. Must be set.\\\"\u003e\u003c\\/username\u003e/\u003cusername desc=\\\"The username of the admin console. Must be set.\\\"\u003e${username}\u003c\\/username\u003e/\" /etc/loolwsd/loolwsd.xml\r\nperl -pi -e \"s/\u003cpassword desc=\\\"The password of the admin console. Must be set.\\\"\u003e\u003c\\/password\u003e/\u003cpassword desc=\\\"The password of the admin console. Must be set.\\\"\u003e${password}\u003c\\/password\u003e/g\" /etc/loolwsd/loolwsd.xml\r\n\r\n\r\ncp /engines/ssl/public/certs/_Engines_Builder(fqdn).crt /etc/loolwsd/cert.pem\r\ncp /engines/ssl/public/keys/_Engines_Builder(fqdn).key /etc/loolwsd/key.pem\r\n cp /usr/local/share/ca-certificates/engines_internal_ca.crt  /etc/loolwsd/ca-chain.cert.pem\r\n\r\napachectl  start \r\n\r\nmkdir -p  /engines/var/run/flags/\r\n/usr/bin/loolwsd --version --o:sys_template_path=/opt/lool/systemplate --o:lo_template_path=/opt/collaboraoffice5.1 --o:child_root_path=/opt/lool/child-roots --o:file_server_root_path=/usr/share/loolwsd \u0026\r\n\r\necho -n $! \u003e /tmp/col.pid\r\n\r\ntouch /engines/var/run/flags/startup_complete\r\n\r\n\r\napapid=`cat /var/run/apache2/apache2.pid`\r\necho -n \" $ngpid\" \u003e\u003e /tmp/col.pid\r\nwait\r\nrm /engines/var/run/flags/startup_complete\r\nsleep 600","custom_install_script":"#!/bin/bash\r\n\r\n##Engines Stuff to go in Builder\r\nadduser -q --disabled-password  -uid 11111 data-user\r\ngroupadd -g 22020 containers\r\ngroupadd -g 11111 data-user\r\nusermod -G containers -a lool\r\nusermod -G data-user -a lool\r\nmkdir /var/run/engines\r\nchgrp containers /var/run/engines\r\nchmod g+w /var/run/engines\t\r\n##-Engines \r\n\r\nchown -R lool /etc/loolwsd\r\n\r\nchown  lool /var/log/\r\n\r\nmkdir /var/run/apache2\r\n\r\nchown  lool  /var/run/apache2\r\nchown  lool -R /etc/apache2/sites-enabled/\r\n\r\na2enmod proxy ssl proxy_wstunnel proxy_http\r\ncp /home/ports.conf /etc/apache2/\r\nsed -i.bak s/www-data/lool/ /etc/apache2/envvars \r\ncp /home/001-default.conf /etc/apache2/sites-enabled/000-default.conf ","custom_post_install_script":"","service_configurations":[{"publisher_namespace":"EnginesSystem","type_path":"cert_auth","variables":{"domainname":"_Engines_Builder(fqdn)","cert_name":"_Engines_Builder(fqdn)","person":"collabora","city":"Local","organisation":"Engines Internal","state":"NSW","country":""}}],"persistent_directories":[{"path":"data"}],"replacement_strings":[],"persistent_files":[],"installed_packages":[{"name":"Collabora","source_url":"collabora/code","destination":"lool","extraction_command":"docker","path_to_extracted":"MKNOD"}],"system_packages":[{"package":"apache2"}],"workers":[],"ports":[{"port":5222,"external":5222,"protocol":"TCP"},{"port":9980,"external":9980,"protocol":"TCP"}],"external_repositories":[],"rake_tasks":[],"template_files":[{"title":"nginx_site","path":"/home/nginx.site","content":"  \r\n\r\nproxy_http_version 1.1;\r\nproxy_buffering off;\r\n\r\n\r\n\r\nserver {\r\n    listen       5222 ssl;\r\n    server_name  _Engines_Builder(fqdn);\r\n\r\n    ssl_certificate /etc/loolwsd/cert.pem;\r\n    ssl_certificate_key  /etc/loolwsd/key.pem;\r\n\r\n # static files\r\n    location ^~ /loleaflet {\r\n        proxy_pass https://127.0.0.1:9980;\r\n        proxy_set_header Host $http_host;\r\n    }\r\n\r\n    # WOPI discovery URL\r\n    location ^~ /hosting/discovery {\r\n        proxy_pass https://127.0.0.1:9980;\r\n        proxy_set_header Host $http_host;\r\n    }\r\nrewrite \"/lool/(.*)/ws$\"      wss://127.0.0.1:9980/lool/$1/ws permanent;\r\n    # Main websocket\r\n    location ~ /lool/(.*)/ws$ {\r\n\r\n        proxy_pass https://127.0.0.1:9980;\r\n        proxy_set_header Upgrade $http_upgrade;\r\n        proxy_set_header Connection \"Upgrade\";\r\n        proxy_set_header Host $http_host;\r\n        proxy_read_timeout 36000s;\r\n    }\r\n\r\n    # Admin Console websocket\r\n    location ^~ /lool/adminws {\r\n        proxy_pass https://127.0.0.1:9980;\r\n        proxy_set_header Upgrade $http_upgrade;\r\n        proxy_set_header Connection \"Upgrade\";\r\n        proxy_set_header Host $http_host;\r\n        proxy_read_timeout 36000s;\r\n    }\r\n\r\n    # download, presentation and image upload\r\n    location ^~ /lool {\r\n        proxy_pass https://127.0.0.1:9980;\r\n        proxy_set_header Host $http_host;\r\n    }\r\n}"},{"title":"loolwsd.xml","path":"/home/loolwsd.xml","content":"\u003cconfig\u003e\r\n\r\n    \u003c!-- Note: 'default' attributes are used to document a setting's default value as well as to use as fallback. --\u003e\r\n    \u003c!-- Note: When adding a new entry, a default must be set in WSD in case the entry is missing upon deployment. --\u003e\r\n\r\n    \u003ctile_cache_path desc=\"Path to a directory where to keep the tile cache.\" type=\"path\" relative=\"false\" default=\"/var/cache/loolwsd\"\u003e\u003c/tile_cache_path\u003e\r\n    \u003csys_template_path desc=\"Path to a template tree with shared libraries etc to be used as source for chroot jails for child processes.\" type=\"path\" relative=\"true\" default=\"systemplate\"\u003e\u003c/sys_template_path\u003e\r\n    \u003clo_template_path desc=\"Path to a LibreOffice installation tree to be copied (linked) into the jails for child processes. Should be on the same file system as systemplate.\" type=\"path\" relative=\"false\" default=\"/opt/collaboraoffice5.1\"\u003e\u003c/lo_template_path\u003e\r\n    \u003cchild_root_path desc=\"Path to the directory under which the chroot jails for the child processes will be created. Should be on the same file system as systemplate and lotemplate. Must be an empty directory.\" type=\"path\" relative=\"true\" default=\"jails\"\u003e\u003c/child_root_path\u003e\r\n\r\n    \u003cserver_name desc=\"Hostname:port of the server running loolwsd. If empty, it's derived from the request.\" type=\"string\" default=\"\"\u003e\u003c/server_name\u003e\r\n    \u003cfile_server_root_path desc=\"Path to the directory that should be considered root for the file server. This should be the directory containing loleaflet.\" type=\"path\" relative=\"true\" default=\"loleaflet/../\"\u003e\u003c/file_server_root_path\u003e\r\n\r\n    \u003cnum_prespawn_children desc=\"Number of child processes to keep started in advance and waiting for new clients.\" type=\"uint\" default=\"1\"\u003e1\u003c/num_prespawn_children\u003e\r\n    \u003cper_document desc=\"Document-specific settings, including LO Core settings.\"\u003e\r\n        \u003cmax_concurrency desc=\"The maximum number of threads to use while processing a document.\" type=\"uint\" default=\"4\"\u003e4\u003c/max_concurrency\u003e\r\n    \u003c/per_document\u003e\r\n\r\n    \u003cloleaflet_html desc=\"Allows UI customization by replacing the single endpoint of loleaflet.html\" type=\"string\" default=\"loleaflet.html\"\u003eloleaflet.html\u003c/loleaflet_html\u003e\r\n\r\n    \u003clogging\u003e\r\n        \u003ccolor type=\"bool\"\u003etrue\u003c/color\u003e\r\n        \u003clevel type=\"string\" desc=\"Can be 0-8, or none (turns off logging), fatal, critical, error, warning, notice, information, debug, trace\" default=\r\n\"warning\"\u003ewarning\u003c/level\u003e\r\n        \u003cfile enable=\"false\"\u003e\r\n            \u003cproperty name=\"path\" desc=\"Log file path.\"\u003e/var/log/loolwsd.log\u003c/property\u003e\r\n            \u003cproperty name=\"rotation\" desc=\"Log file rotation strategy. See Poco FileChannel.\"\u003enever\u003c/property\u003e\r\n            \u003cproperty name=\"archive\" desc=\"Append either timestamp or number to the archived log filename.\"\u003etimestamp\u003c/property\u003e\r\n            \u003cproperty name=\"compress\" desc=\"Enable/disable log file compression.\"\u003etrue\u003c/property\u003e\r\n            \u003cproperty name=\"purgeAge\" desc=\"The maximum age of log files to preserve. See Poco FileChannel.\"\u003e10 days\u003c/property\u003e\r\n            \u003cproperty name=\"purgeCount\" desc=\"The maximum number of log archives to preserve. Use 'none' to disable purging. See Poco FileChannel.\"\u003e10\u003c/property\u003e\r\n            \u003cproperty name=\"rotateOnOpen\" desc=\"Enable/disable log file rotation on opening.\"\u003etrue\u003c/property\u003e\r\n            \u003cproperty name=\"flush\" desc=\"Enable/disable flushing after logging each line. May harm performance. Note that without flushing after each line, the log lines from the different processes will not appear in chronological order.\"\u003efalse\u003c/property\u003e\r\n        \u003c/file\u003e\r\n    \u003c/logging\u003e\r\n\r\n    \u003ctrace desc=\"Dump commands and notifications for replay\" enable=\"true\"\u003e\r\n       \u003cpath desc=\"Output file path\" compress=\"true\"\u003e/tmp/looltrace.gz\u003c/path\u003e\r\n        \u003cfilter\u003e\r\n            \u003cmessage desc=\"Regex pattern of messages to exclude\"\u003e\u003c/message\u003e\r\n        \u003c/filter\u003e\r\n        \u003coutgoing\u003e\r\n            \u003crecord desc=\"Whether or not to record outgoing messages\" default=\"false\"\u003efalse\u003c/record\u003e\r\n        \u003c/outgoing\u003e\r\n    \u003c/trace\u003e\r\n\r\n    \u003cssl desc=\"SSL settings\"\u003e\r\n        \u003cenable type=\"bool\" default=\"true\"\u003etrue\u003c/enable\u003e\r\n        \u003ctermination desc=\"Connection via proxy where loolwsd acts as working via https, but actually uses http.\" type=\"bool\" default=\"true\"\u003etrue\u003c/termination\u003e\r\n        \u003ccert_file_path desc=\"Path to the cert file\" relative=\"false\"\u003e/etc/loolwsd/cert.pem\u003c/cert_file_path\u003e\r\n        \u003ckey_file_path desc=\"Path to the key file\" relative=\"false\"\u003e/etc/loolwsd/key.pem\u003c/key_file_path\u003e\r\n        \u003cca_file_path desc=\"Path to the ca file\" relative=\"false\"\u003e/etc/loolwsd/ca-chain.cert.pem\u003c/ca_file_path\u003e\r\n    \u003c/ssl\u003e\r\n\r\n    \u003cstorage desc=\"Backend storage\"\u003e\r\n        \u003cfilesystem allow=\"false\" /\u003e\r\n        \u003cwopi desc=\"Allow/deny wopi storage. Mutually exclusive with webdav.\" allow=\"true\"\u003e\r\n            \u003chost desc=\"Regex pattern of hostname to allow or deny.\" allow=\"true\"\u003elocalhost\u003c/host\u003e\r\n  \u003chost desc=\"Regex pattern of hostname to allow or deny.\" allow=\"true\"\u003e_Engines_Builder(fqdn)\u003c/host\u003e\r\n \u003chost desc=\"Regex pattern of hostname to allow or deny.\" allow=\"true\"\u003e_Engines_Environment(owncloudhost)\u003c/host\u003e\r\n\r\n            \u003chost desc=\"Regex pattern of hostname to allow or deny.\" allow=\"true\"\u003e10\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\u003c/host\u003e\r\n            \u003chost desc=\"Regex pattern of hostname to allow or deny.\" allow=\"true\"\u003e172\\.1[6789]\\.[0-9]{1,3}\\.[0-9]{1,3}\u003c/host\u003e\r\n            \u003chost desc=\"Regex pattern of hostname to allow or deny.\" allow=\"true\"\u003e172\\.2[0-9]\\.[0-9]{1,3}\\.[0-9]{1,3}\u003c/host\u003e\r\n            \u003chost desc=\"Regex pattern of hostname to allow or deny.\" allow=\"true\"\u003e172\\.3[01]\\.[0-9]{1,3}\\.[0-9]{1,3}\u003c/host\u003e\r\n            \u003chost desc=\"Regex pattern of hostname to allow or deny.\" allow=\"true\"\u003e192\\.168\\.[0-9]{1,3}\\.[0-9]{1,3}\u003c/host\u003e\r\n            \u003chost desc=\"Regex pattern of hostname to allow or deny.\" allow=\"false\"\u003e192\\.168\\.1\\.1\u003c/host\u003e\r\n            \u003cmax_file_size desc=\"Maximum document size in bytes to load. 0 for unlimited.\" type=\"uint\"\u003e0\u003c/max_file_size\u003e\r\n        \u003c/wopi\u003e\r\n        \u003cwebdav desc=\"Allow/deny webdav storage. Mutually exclusive with wopi.\" allow=\"false\"\u003e\r\n            \u003chost desc=\"Hostname to allow\" allow=\"false\"\u003enorth.current.engines.org\u003c/host\u003e\r\n\r\n        \u003c/webdav\u003e\r\n    \u003c/storage\u003e\r\n\r\n    \u003cadmin_console desc=\"Web admin console settings.\"\u003e\r\n        \u003cusername desc=\"The username of the admin console. Must be set.\"\u003e\u003c/username\u003e\r\n        \u003cpassword desc=\"The password of the admin console. Must be set.\"\u003e\u003c/password\u003e\r\n    \u003c/admin_console\u003e\r\n\r\n\u003c/config\u003e\r\n"},{"title":"001-default.conf","path":"/home/001-default.conf","content":"\u003cVirtualHost *:5222\u003e\r\n  ServerName _Engines_Builder(fqdn):5222\r\n\r\n  # SSL configuration, you may want to take the easy route instead and use Lets Encrypt!\r\n  SSLEngine on\r\n  SSLCertificateFile /etc/loolwsd/cert.pem\r\n  SSLCertificateChainFile /usr/local/share/ca-certificates/engines_internal_ca.crt\r\n  SSLCertificateKeyFile         /etc/loolwsd/key.pem\r\n\r\n  SSLProtocol             all -SSLv2 -SSLv3\r\n  SSLCipherSuite ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS\r\n  SSLHonorCipherOrder     on\r\n\r\n  # Encoded slashes need to be allowed\r\n  AllowEncodedSlashes NoDecode\r\n\r\n  # Container uses a unique non-signed certificate\r\n  SSLProxyEngine On\r\n  SSLProxyVerify None\r\n  SSLProxyCheckPeerCN Off\r\n  SSLProxyCheckPeerName Off\r\n\r\n  # keep the host\r\n  ProxyPreserveHost On\r\n\r\n  # static html, js, images, etc. served from loolwsd\r\n  # loleaflet is the client part of LibreOffice Online\r\n  ProxyPass           /loleaflet https://127.0.0.1:9980/loleaflet retry=0\r\n  ProxyPassReverse    /loleaflet https://127.0.0.1:9980/loleaflet\r\n\r\n  # WOPI discovery URL\r\n  ProxyPass           /hosting/discovery https://127.0.0.1:9980/hosting/discovery retry=0\r\n  ProxyPassReverse    /hosting/discovery https://127.0.0.1:9980/hosting/discovery\r\n\r\n  # Main websocket\r\n  ProxyPassMatch \"/lool/(.*)/ws$\" wss://127.0.0.1:9980/lool/$1/ws nocanon\r\n\r\n  # Admin Console websocket\r\n  ProxyPass   /lool/adminws wss://127.0.0.1:9980/lool/adminws\r\n\r\n  # Download as, Fullscreen presentation and Image upload operations\r\n  ProxyPass           /lool https://127.0.0.1:9980/lool\r\n  ProxyPassReverse    /lool https://127.0.0.1:9980/lool\r\n\r\n  ErrorLog /var/log/error.log\r\n        CustomLog /var/log/access.log combined\r\n\r\n\u003c/VirtualHost\u003e\r\n"},{"title":"","path":"/home/ports.conf","content":"# If you just change the port or add more ports here, you will likely also\r\n# have to change the VirtualHost statement in\r\n# /etc/apache2/sites-enabled/000-default.conf\r\n\r\n\r\n\r\n\u003cIfModule ssl_module\u003e\r\n        Listen 5222 https\r\n\u003c/IfModule\u003e\r\n\r\n\u003cIfModule mod_gnutls.c\u003e\r\n        Listen 5222 https\r\n\u003c/IfModule\u003e\r\n\r\n# vim: syntax=apache ts=4 sw=4 sts=4 sr noet"}],"file_write_permissions":[],"custom_php_inis":[],"apache_htaccess_files":[],"apache_httpd_configurations":[],"modules":[],"variables":[{"name":"owncloudhost","value":"owncloud._Engines_Builder(fqdn)","label":"Owncloud or NewCloud host name site ","field_type":"","select_collection":"","tooltip":"owncloud.mydomain.tld","hint":"","placeholder":"","comment":"","regex_validator":"","regex_invalid_message":"","mandatory":true,"ask_at_build_time":true,"build_time_only":false,"immutable":false},{"name":"domain","value":"_Engines_Builder(fqdn)","label":"","field_type":"","select_collection":"","tooltip":"","hint":"","placeholder":"","comment":"","regex_validator":"","regex_invalid_message":"","mandatory":false,"ask_at_build_time":false,"build_time_only":false,"immutable":false}],"component_sources":[],"component_path":"","extract_components":false,"installation_report_template":"","continuous_deployment":false,"database_seed_file":"","actionators":{}}}